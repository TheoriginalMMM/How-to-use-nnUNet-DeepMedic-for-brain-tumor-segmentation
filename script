#nnUnet Instalaiton
#get cuda version
nvcc --version
#Check GPU info
nvidia-smi
#find the path to cuda
whereis -b cuda
#To check cudnn version
cat /path/to/cuda/include/cudnn_version.h | grep CUDNN_MAJOR -A 2

#check Tf installed version
python3 -c 'import tensorflow as tf; print(tf.__version__)'

conda install pytorch torchvision torchaudio cudatoolkit=11.1 -c pytorch -c nvidia

cd RepInstalation

git clone https://github.com/MIC-DKFZ/nnUNet.git
cd nnUNet
pip install -e

SetUp Paths:
nnUNet_raw_data_base (lA ou l'utilisateur va préparaer la bonne structure de la data )
nnUNet_preprocessed ( De préference sur un disk rapide ssd)
RESULTS_FOLDER : pour sauvgarder les poids des models à la fin.

Solution :
export nnUNet_raw_data_base="/media/fabian/nnUNet_raw"
export nnUNet_preprocessed="/media/fabian/nnUNet_preprocessed"
export RESULTS_FOLDER="/media/fabian/nnUNet_trained_models"


(OPTIONAL) Install hiddenlayer : (pour visiuaiserdes plots)
pip install --upgrade git+https://github.com/FabianIsensee/hiddenlayer.git@more_plotted_details#egg=hiddenlayer

#Instalation check
nnUNet_print_available_pretrained_models

#DeepMedic istall

#Clone software:
git clone https://github.com/Kamnitsask/deepmedic/
#virtuel environement set up (Le nom peut etre changé à DeepMedi
conda create -p FOLDER_FOR_ENVS/ve_DeepMedic python=3.6.5 -y
source activate FOLDER_FOR_ENVS/ve_DeepMedic

#Install TensorFlow 2 Using pip (prerequis =  CUDA version and cuDNN versions)
#(my set up => TF=2.6.0 Cuda=11.4 Cudnn=8.2.2 )
#Comptabilitys infos => https://www.tensorflow.org/install/source
#compatible with the tensorflow version you are installing.

#In case : cudNN instalation instruction
#downoad here : https://developer.nvidia.com/cudnn
#copey the cudnn.h file
sudo cp ./cuda/include/cudnn.h /usr/local/cuda/include
#Copy all files under cuda/lib64/to the/usr/local/cuda/lib64 folder and add read permissions:
sudo cp ./cuda/lib64/* /usr/local/cuda/lib64
sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*
#TF install
pip install --upgrade pip
pip install tensorflow

#Finaly :
cd DEEPMEDIC_ROOT_FOLDER
pip install .
#Check this paths :
#$ export CUDA_HOME=/path/to/cuda                   # If using cshell instead of bash: setenv CUDA_HOME /path/to/cuda
#$ export LD_LIBRARY_PATH=/path/to/cuda/lib64
#$ export PATH=/path/to/cuda/bin:$PATH

#Quick instalation test
./deepMedicRun -model ./examples/configFiles/tinyCnn/model/modelConfig.cfg \
               -train examples/configFiles/tinyCnn/train/trainConfigWithValidation.cfg
#./exemples/output have to apeare
# Training board  check
python plotTrainingProgress.py examples/output/logs/trainSessionWithValidTiny.txt -d
tensorboard --logdir=./examples/output/tensorboard/trainSessionWithValidTiny

#GPU runing check
./deepMedicRun -model ./examples/configFiles/tinyCnn/model/modelConfig.cfg \
               -train ./examples/configFiles/tinyCnn/train/trainConfigWithValidation.cfg \
               -dev cuda0
               
#Drive pour télecharge la BD 
https://drive.google.com/drive/folders/1HqEgzS8BV2c7xYNrZdEAnrHk7osJJ--2?fbclid=IwAR2eGWwSYSQ9a8MOnv6D0atinrZGJuTWCEEhk3wTkecnNa8kLyyRIs88iyo


